---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const POSTS_PER_PAGE = 10;
const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE);
const displayPosts = posts.slice(0, POSTS_PER_PAGE);
---

<BaseLayout title="A Big Stick">
  <ul class="space-y-8 list-none p-0">
    {displayPosts.map((post) => {
      const slug = post.id.replace(/^\d{4}-\d{2}-\d{2}-/, '');
      const date = post.data.date;
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const href = `/${year}/${month}/${day}/${slug}`;
      const formattedDate = date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
      });

      return (
        <li>
          <a href={href} class="block group no-underline">
            <time class="text-sm text-[var(--color-text-light)]" datetime={date.toISOString()}>
              {formattedDate}
            </time>
            <h2 class="font-heading text-xl font-semibold mt-1 group-hover:text-[var(--color-brand)] transition-colors">
              {post.data.title}
            </h2>
            <p class="text-[var(--color-text-light)] mt-1">{post.data.description}</p>
            {post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-1.5 mt-2">
                {post.data.tags.map((tag: string) => (
                  <span class="inline-block px-2 py-0.5 bg-[var(--color-brand-light)] text-[var(--color-brand)] rounded text-xs">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </a>
        </li>
      );
    })}
  </ul>

  {totalPages > 1 && (
    <nav class="mt-12 flex justify-center gap-2">
      <span class="px-3 py-1 rounded bg-[var(--color-brand)] text-white text-sm">1</span>
      {Array.from({ length: totalPages - 1 }, (_, i) => i + 2).map((page) => (
        <a
          href={`/page/${page}`}
          class="px-3 py-1 rounded border border-[var(--color-border)] text-sm hover:bg-gray-100 transition-colors no-underline"
        >
          {page}
        </a>
      ))}
    </nav>
  )}
</BaseLayout>
